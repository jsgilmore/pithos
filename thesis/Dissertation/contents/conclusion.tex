\chapter{Conclusions and Recommendations}
\label{chp:CONC}

As stated in the introduction: the objective of this work was to design and develop a novel state management and persistency architecture, specifically designed for P2P MMVEs that satisfies all P2P MMVE storage requirements and takes into account the requirements of the consistency architecture in which it will operate.

\section{State consistency}

In order to evaluate and compare the many consistency models described in literature, a generic state consistency model was developed.

The generic consistency model provides a common framework for describing the interaction of modules such as event ordering, event and update dissemination, object storage and interest management.

Thus, the generic consistency model developed provides a framework for the design and development of MMVEs in general. Because many aspects of the generic consistency model are trivial in C/S models, the model is perhaps more applicable to a P2P MMVE environment. This is not to say that the generic model is not able to describe the classic C/S case, just that it contains additional complexity not required to fully describe the classic C/S model.

\section{State management and persistency}

State management determines how objects in primary memory are stored and updated and requires a highly responsive system, State persistency determines how objects will be stored on persistent storage as backup for long term integrity. State persistency, therefore, does not require as responsive a storage system.

From the perspective of a state consistency architecture, five main requirements were identified for state management and state persistency: fairness, reliability, responsiveness, scalability and security.

Although a lack of a thorough comparison of different storage systems in literature made it difficult to empirically compare the existing storage systems, it was found that none of the storage systems satisfy all identified requirements \cite{gilmore_p2p_mmog_state_persistency}. We therefore developed our novel state management and persistency architecture, to fulfil all the previously identified requirements \cite{Pithos_mmve_2011}.

\section{Pithos design}

The Pithos use case is that of a generic storage system, supporting storage, retrieval, modification and removal. Pithos is a hierarchical distributed storage system that uses grouping to reduce latencies of requests, as is required by massively multi-user virtual environments (MMVEs).

Group storage, distance-based storage and replication are used to make Pithos responsive. Overlay storage, replication and repair are used to make Pithos reliable. Certification, replication and quorum mechanisms are used to make Pithos secure. Group storage and overlay storage are used to make Pithos fair.

Users in Pithos are divided into groups which form group storage networks. Group storage networks are $O(1)$ structured overlays that ensure one hop latencies for requests. Super peers exist to manage groups and peer join groups using a directory server. Group ledgers are by each peer to keep track of the peers and objects stored within a group. A third-party $O(\log (N))$ overlay storage implementation is used to allow nodes to retrieve data stored outside of their groups.

Pithos is implemented as an Oversim simulation that runs on the OMNeT++ network simulation framework. The simulation allowed for the evaluation of Pithos using up to 10,400 nodes, using realistic latency profiles.

\section{Pithos evaluation}

The responsiveness and reliability of Pithos was evaluated, taking bandwidth usage into account. Pithos performance was compared to overlay storage performance.

What was found in Pithos is that a trade-off exists between reliability and bandwidth. Pithos can be made highly reliable by increasing the amount of bandwidth used and reliability decreases with a decrease in bandwidth.Pithos is more reliable than overlay storage for the same amount of bandwidth used. Pithos uses a total of 1950 Bps bandwidth to achieve 99.98\% reliability, while the most reliable overlay storage configuration tested achieved 93.65\% reliability, using 2182 Bps bandwidth. Pithos is also more responsive than overlay storage, with a responsiveness of 0.192s, compared with the overlay responsiveness of 1.4s.

A latency of 192ms for Pithos might seem high, but the effect of the underlay network should be taken into account. This was shown by simulating Pithos in a LAN environment, where it achieved a responsiveness of 1.6ms in a network where each hop had a 1ms delay.

When comparing group probabilities, it was found that the worst Pithos could perform was equal to the performance of overlay storage.

The performance of Pithos under invalid data attacks were also investigated for various probabilities of malicious nodes. It was found that Pithos performs consistently better than overlay storage i.t.o. reliability. As expected, using a quorum mechanism further improved the Pithos reliability. At 40\% malicious users, overlay storage is 46\% reliable. In comparison, when using the least bandwidth, Pithos is 60\% reliable whilst it is 96\% reliable when using the most bandwidth.

The distribution of objects on peers were also investigated to determine the fairness of Pithos. It was found that Pithos is comparable i.t.o. fairness to overlay storage.

The scalability of Pithos was also tested, by quadrupling the network size, increasing the number of nodes in the simulation by 300\% from 2600 nodes to 10,400 nodes. The overall reliability and responsiveness remained the same at 99.7\% and 0.19s respectively. The bandwidth usage, however, increased by 20\% from 1375 Bps to 1652 Bps due to increased bandwidth usage by overlay storage.

It was, therefore, found that Pithos is a reliable, responsive, fair and scalable state management and persistency architecture that will be able to fulfill its role as the authoritative object store for the P2P MMVEs of the future.

Simulating for 10,400 nodes is also 10 times larger than the P2P Second Life Walkad simulation of 1024 nodes \cite{Walkad_Varvello}. Before Pithos, Walkad is considered to be the most recent and significant contribution to the area of state management and state persistency for P2P MMVEs. The advantage of Walkad is that it is a practical implementation of a state management and persistency architecture that is already integrated into an existing MMVE. The disadvantages of Walkad are that it does not take security consideration into account; it runs on an existing file sharing network where users may have different usage profiles; it was emulated on a relatively small scale (1024 peers and 600 objects at most); and its theoretical performance is below that of Pithos. The Walkad routing time for local queries is between $O(1)$ and $O(N_c)$ depending on the cell distribution, where Pithos's routing time is fixed at $O(1)$.

\section{Modelling object lifetime}

Since the reliability of Pithos depends on whether an object is available in the storage network, the expected object lifetime has a strong correlation with the system reliability. It was therefore deemed important to be able to predict expected object lifetimes in realistic network under realistic network effects, such as churn.

A deficiency was discovered in the literature on object lifetime prediction. It was assumed that an infinite network existed into which an object is placed. This is in contradiction to the Pithos case, where size limited groups exist. Group sizes in Pithos might be comparable to the number of required replicas in the system. When this occurs, it is sometimes not possible to insert the required number of replicas in the system. Existing Markov chain models were extended to take finite network sizes into account.

Object lifetime was found to be dependant on the node departure rate, average network size under steady state, the required number of replicas and the object repair rate. The object lifetime predictions from the model were compared to object lifetimes measured in Pithos. The predicted expected object lifetimes were found to be within 3\% of the measured values, which validates the correctness of the Pithos implementation.

\section{Recommendations}

\subsection{State management and persistency}
It is believed that a greater focus should be placed on whether an authoritative storage design is designed for state management or state persistency. As we discussed, it seems logical that some requirements, such as responsiveness, are not applicable to both, which might allow for different design choices.

It might be of benefit to develop a generic state categorisation, where a study is performed to identify the types of states in P2P MMVEs, along with their characteristics and how different types of states are altered. Similarities might be investigated and used to define a finite set of state types and interactions with these types. This would allow for further optimisation to distributed storage systems for P2P MMVEs.

\subsection{P2P MMVEs}
Significant research effort has now been invested to solve the remaining challenges of P2P MMVEs, with some issues, most notably security, ever present in P2P networks. Future work in P2P MMVEs should not be on further improving the various modules of state consistency, but rather in building a complete architecture.

Possible applications for such a complete P2P MMVE include:
%
\begin{itemize}
\item Development of a P2P virtual conference environment.
\item Distributed social networks, since social networks usually possess natural grouping elements in the social network that may be directly transferred to the network layer.
\item Free-to-play P2P MMOGs, playing to the strengths of P2P MMVEs such are responsive environments.
\end{itemize}

Responsive MMVEs are an especially interesting field, since these types of MMVEs are not currently possible in classic C/S MMVEs. All MMVEs have high latencies while playing (in the order of 200ms). This only supports specific genres of games, such as strategy games and RPGs. It is currently difficult to support first-person shooters or racing games using the MMVE paradigm, although the recently launched Planetside 2 shows progress in this direction.

Something that might have to be reevaluated is whether the P2P design paradigm still makes sense in an economy where bandwidth is becoming much cheaper and where hosting a server in the cloud is a possibility. A study on the economics of P2P versus centralised architectures would be an interesting future research topic to determine whether the reasons for moving away from a centralised architecture remain valid in the current cloud age.

Another way to approach the migration into the cloud would be to transfer what was learned from P2P MMVEs, which are distributed application, into a new field of MMVEs that exist in the cloud. It seems that much of what was learned from distributed applications remain valuable for a cloud age.

\section{Future work}

\subsection{State management and persistency}

\begin{itemize}
\item An empirical comparison of the various state management and persistency architectures would be beneficial. As seen in our evaluation of overlay storage, it was less reliable than originally thought. Empirical comparisons between other storage types might lead to similar discoveries.

\item The interaction between state management and state persistency has not been explored in detail. Further research is required in determining when to back-up state to persistent storage and what types of state require persistent backups.

\item A categorisation of different types of state will be helpful. Especially in terms of the differences in requirements. Distinctions such as ephemeral as opposed to permanent state might be investigated. The storage parameters, such as object TTL, for ephemeral state, compared to permanent state will be different. Storage system can then distinguish different types of state and treat them differently to improve overall performance.
\end{itemize}

\subsection{Pithos}
\begin{itemize}
\item Request distributions should be investigated. The rate at which different virtual worlds generate storage, retrieval and modification requests to the authoritative store. How regularly objects are updated, how regularly objects are created and also retrieved should be investigated. The ratios of different requests should also be investigated. It is assumed that the request profile will vary depending on the game type (World of Warcraft vs. Second Life). A better understanding of request profiles and their reliability and responsiveness requirements might allow for improvements to Pithos.

\item Pithos is an authoritative object store that will function within a consistency architecture. The question arises whether there are certain aspects of the consistency framework that has to take the Pithos architecture into consideration. An example of this might be the type of interest management schemes used for event and update interest management. It can be investigates whether some interest management schemes are more appropriate to the architecture of Pithos.

\item Pithos is an authoritative object store that forms part of a consistency framework, but the network topology of Pithos might be used by other aspects of the consistency framework as well. For example, two models to maintain consistency between authoritative and non-authoritative objects might be investigated. It might be possible to use an event-based consistency model for group storage, while using an update-based consistency model for overlay storage. There might be some advantages to using two levels of consistency models, for example an increase in responsiveness through the use of the event-based model in group storage.
\end{itemize}

\subsubsection{Real-world implementation}
\begin{itemize}
\item The next step in the Pithos implementation will be to add libraries to allow for physical network operation and then to deploy Pithos on a global scale network, such as PlanetLab. Although PlanetLab will not be able to show Pithos for larger numbers of nodes than one or two thousand, it will show real-world performance. It will also enable the measurement of resource requirements on a per-node basis, such as processor and memory requirements, that are quantities that cannot easily be measured in simulation.

\item Before a real-world implementation, a ``hardware in the loop'' implementation of Pithos might be done. Oversim supports real-world computers to be connected to the simulated network. This will allow for the Pithos to be tested on a computer to determine memory and CPU requirements, while still having a larger network than what PlanetLab can provide.
\end{itemize}

\subsubsection{Remaining performance comparisons}

\begin{itemize}
\item A study should be made to determine what are acceptable levels of retrieval reliability in MMVEs. This might tie in with the study on different object storage classes proposed earlier. Pithos might then be extended to provide assurances of reliability levels. This can be achieved by using request-retry mechanisms and by dynamically adjusting repair rates as a function of network churn.
    
\item The performance of Pithos should be evaluated with peer and super peer movement traces captured from a virtual world, instead of the random walk movement model used.
    
\item More work is required into testing the performance of object modification in Pithos. This requires the above-mentioned request distributions to determine how regularly objects are updated and how significant object updated are, compared to the object sizes. This may lead to improvements in the object modification design that may have specialised handling mechanisms for different types of object updated.

\item Pithos should be compared to other storage systems, for example super peer storage and distance-based storage.
    
\item The Pithos evaluation has used a fixed ratio of super peers to peers. Although group sizes from 5 to 50 nodes per group were experienced during testing, the effect of group density on storage will have to be investigated. Group traffic as a function of group density should be investigated to determine for which group densities group storage is no longer scalable.
\end{itemize}

\subsubsection{Grouping}
\begin{itemize}
\item Various distributed grouping algorithms should be compared to establish which work best in the P2P MMVE and Pithos context. A distributed grouping algorithm should then be selected or developed for Pithos, using avatar movement traces.
    
\item In the evaluation of Pithos, it was seen that the best performance is achieved when more requests remain local to the group. A grouping algorithm should therefore be evaluated in terms of how well it can localise requests when actual user and object traces are used for a variety of virtual environments. The more group requests, the better the overall performance will be.

\item A group-based distance-based storage scheme should be designed for Pithos, where virtual objects are mapped to the nearest group of peers.

\item The group-based approach designed for Pithos should be compared to region-based approaches.
\end{itemize}

\subsubsection{Super peers}
\begin{itemize}
\item Super peers can also be made part of a Voronoi network, which will allow each super peer to be aware of their neighbours in the virtual world. A distributed join mechanism can then be implemented, where a single random node can be used as entry point into the network. Super peer can pass a join request on to another super peer that is closer to the joining node.
    
\item Backup super peers will have to be implemented to ensure that super peers leaving the network does not affect group consistency. This task should be assisted by the fact that all peers already contain all group state information.
    
\item A super peer selection scheme should be implemented for Pithos that will determine which peers are selected as super peers. Reputation schemes might be investigated to select super peers by. Super peers might also be demoted if they are found to be malicious. The number of required super peers should also be investigated, and might depend on the grouping algorithm used and the allowable group density.
\end{itemize}

\subsubsection{Quorum}
\begin{itemize}
\item Many enhancements can be made to the quorum mechanism. When a parallel request is performed, a single object can be requested and multiple hashes of the object can be requested from other nodes. The hash of the received object can be compared with the hashes received from other nodes. If the received object has matches a majority of received hashes, the retrieval was successful. If not, another node that did contain the correct object might be queried. This approach will reduce responsiveness but decrease bandwidth usage.

\item Quorum techniques for overlay storage can be implemented and a comparison of Pithos using quorum can then be done with overlay storage using quorum.
\end{itemize}